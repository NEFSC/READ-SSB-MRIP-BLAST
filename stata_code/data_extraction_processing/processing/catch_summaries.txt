<<dd_version: 2>>

<!---Execute this with:

do $MRIP_BLAST


if strmatch("$user","minyangWin"){
	global project_dir  "C:/Users/Min-Yang.Lee/Documents/READ-SSB-Lee-MRIP-BLAST/" 
}


/* setup directories */
global code_dir "${project_dir}/stata_code"
global working_data "${project_dir}/working_data"
global output_dir "${project_dir}/output"

dyndoc "$processing_code/catch_summaries.txt", saving($my_results/catch_summaries_${this_working_year}.html) replace

 ---> 



Effort  statistics 
===============================================================


BLAST inputs:

1.  Annual Length-frequency for cod and haddock. 
2.  Monthly Catch-per-trip for cod and haddock. 
3.  Total trips.  We will use FY 2022 data, but use Waves 1 and 2 from 2022  in place of the Waves 1 and 2 of 2023 (as usual). There's no trips in Wave 6.



~~~~
<<dd_do:quietly>>
/* If you dyndoc this right after running your MRIP data processing code, you can comment this out.*/
do $MRIP_BLAST
global vintage_string 2023_01_04
global my_outputdir "${data_main}/MRIP_$vintage_string/monthly"

global FY_dir "${data_main}/MRIP_$vintage_string/fishing_years"
local my_common1 "atlanticcod"
local my_common2 "haddock"

global this_year = 2022
global last_year = $this_year-1
<</dd_do>>
~~~~

Here are monthly number of trips in Calendar Year <<dd_display: %4.0f $last_year>>. 



~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common1'_`my_common2'_target_${last_year}.dta", replace
sort year month 
<</dd_do>>

<<dd_do>>
list year month dtrip, abbreviate(16)
<</dd_do>>
~~~~


And here are monthly number trips for <<dd_display: %4.0f $this_year>>.  
~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common1'_`my_common2'_target_${this_year}.dta", replace
sort year month
local april=dtrip[1] 
<</dd_do>>

<<dd_do>>
list year month dtrip, abbreviate(16)
<</dd_do>>
~~~~

Data was processed on <<dd_display: c(current_date)>>. 

I am using preliminary Wave 5 data for Sept and October of 2022.  As always, we use November and December of <<dd_display: %4.0f $last_year>> in place of November and December of <<dd_display: %4.0f $this year>>. And we will use Jan-April, <<dd_display: %4.0f $this_year>> in place of Jan-April, <<dd_display: %4.0f $this_year+1>>.



Here are trips, by fishing year:

~~~~
<<dd_do:quietly>>
use "${FY_dir}/FY_targeting.dta", replace
/* 2018 has partial data in it (From April of 2019)*/
drop if fishing_year<$last_year
sort fishing_year
expand 2 if fishing_year==${this_year}, gen(tag)
replace dtrip=dtrip+`april' if fishing_year==${this_year} & tag==1
tostring fishing_year, replace
replace fishing_year=fishing_year+"Proj" if fishing_year=="${this_year}" & tag==1
replace fishing_year=fishing_year+"Actual" if fishing_year=="${this_year}" & tag==0
drop tag
sort fishing_year

<</dd_do>>

<<dd_do>>
list, abbreviate(16)
<</dd_do>>
~~~~
FY 2022 data is partial


Catch Statistics for Cod  
===============================================================


Here are the cod (a, b1, b2) in numbers for Calendar Year <<dd_display: %4.0f $last_year>>.  
~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common1'_landings_${last_year}.dta", replace
sort year month 
format tot_cat* a b1 b2 landings* %10.0fc
<</dd_do>>

<<dd_do>>
list , abbreviate(16)  sum(tot_cat* a b1 b2 landings*)
<</dd_do>>
~~~~

Here are the cod (a, b1, b2) in numbers for Calendar Year <<dd_display: %4.0f $this_year>>. 
~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common1'_landings_${this_year}.dta", replace
sort year month 
format tot_cat* a b1 b2 landings %10.0fc
<</dd_do>>

<<dd_do>>
list , abbreviate(16)  sum(tot_cat* a b1 b2 landings*)
<</dd_do>>
~~~~



Here are the cod (a+b1 and b2) in weights and numbers for Calendar Year<<dd_display: %4.0f $last_year>>. 
~~~~
<<dd_do:quietly>>
use "${data_main}/MRIP_${vintage_string}/monthly/cod_weights_${last_year}.dta", clear

gen ab1_lbs_per_fish=ab1weight/ab1_count
gen b2_lbs_per_fish=b2weight/b2_count
format ab1_lbs_per_fish b2_lbs_per_fish %4.3fc

replace ab1weight=ab1weight/2204
rename ab1weight ab1mt
replace b2weight=b2weight/2204
rename b2weight b2mt

sort year month 
format ab1mt b2mt %10.2fc
format ab1_count b2_count %10.0fc
keep if year==$last_year
<</dd_do>>


<<dd_do>>
list year month ab1mt b2mt ab1_count b2_count ab1_lbs_per_fish b2_lbs_per_fish, abbreviate(16) sum(ab1mt b2mt ab1_count b2_count) 
<</dd_do>>
~~~~



Here are the cod (a+b1 and b2) in weights and numbers for Calendar Year <<dd_display: %4.0f $this_year>>. 
~~~~
<<dd_do:quietly>>
use "${data_main}/MRIP_${vintage_string}/monthly/cod_weights_${this_year}.dta", clear

gen ab1_lbs_per_fish=ab1weight/ab1_count
gen b2_lbs_per_fish=b2weight/b2_count
format ab1_lbs_per_fish b2_lbs_per_fish %4.3fc

replace ab1weight=ab1weight/2204
rename ab1weight ab1mt
replace b2weight=b2weight/2204
rename b2weight b2mt

sort year month 
format ab1mt b2mt %10.2fc
format ab1_count b2_count %10.0fc

keep if year==$this_year
<</dd_do>>
<<dd_do>>

list year month ab1mt b2mt ab1_count b2_count ab1_lbs_per_fish b2_lbs_per_fish, abbreviate(16) sum(ab1mt b2mt ab1_count b2_count)
<</dd_do>>
~~~~




Catch Statistics for Haddock  
===============================================================


Here are the haddock (a, b1, b2) in numbers for Calendar Year <<dd_display: %4.0f $last_year>>. 
~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common2'_landings_${last_year}.dta", replace
sort year month 
format tot_cat* a b1 b2 landings %10.0fc
<</dd_do>>
<<dd_do>>
list , abbreviate(16)  sum(tot_cat* a b1 b2 landings*)
<</dd_do>>
~~~~

Here are the haddock (a, b1, b2) in numbers for Calendar Year <<dd_display: %4.0f $this_year>>.  With the data update, there are both b1's and B2s in April.
~~~~
<<dd_do:quietly>>
use "${my_outputdir}/`my_common2'_landings_${this_year}.dta", replace
sort year month 
format tot_cat* a b1 b2 landings* %10.0fc
<</dd_do>>
<<dd_do>>
list , abbreviate(16) sum(tot_cat* a b1 b2 landings*)
<</dd_do>>
~~~~




Here are the haddock (a+b1 and b2) in weights and numbers for Calendar Year <<dd_display: %4.0f $last_year>>.  
~~~~
<<dd_do:quietly>>
use "${data_main}/MRIP_${vintage_string}/monthly/haddock_weights_${last_year}.dta", clear

gen ab1_lbs_per_fish=ab1weight/ab1_count
gen b2_lbs_per_fish=b2weight/b2_count
format ab1_lbs_per_fish b2_lbs_per_fish %4.3fc

replace ab1weight=ab1weight/2204
rename ab1weight ab1mt
replace b2weight=b2weight/2204
rename b2weight b2mt

sort year month 
format ab1mt b2mt %10.2fc
format ab1_count b2_count %10.0fc

keep if year==$last_year
<</dd_do>>

<<dd_do>>
list year month ab1mt b2mt ab1_count b2_count ab1_lbs_per_fish b2_lbs_per_fish, abbreviate(16) sum(ab1mt b2mt ab1_count b2_count)
<</dd_do>>
~~~~



Here are the haddock (a+b1 and b2) in weights and numbers for Calendar Year <<dd_display: %4.0f $this_year>>. With the data update, there are both b1's and B2s in April.  There are also measured B2 haddock from July-October now.  The weights per fish look reasonable.
~~~~
<<dd_do:quietly>>
use "${data_main}/MRIP_${vintage_string}/monthly/haddock_weights_${this_year}.dta", clear

gen ab1_lbs_per_fish=ab1weight/ab1_count
gen b2_lbs_per_fish=b2weight/b2_count
format ab1_lbs_per_fish b2_lbs_per_fish %4.3fc

replace ab1weight=ab1weight/2204
rename ab1weight ab1mt
replace b2weight=b2weight/2204
rename b2weight b2mt

sort year month 
format ab1mt b2mt %10.2fc
format ab1_count b2_count %10.0fc

keep if year==$this_year
<</dd_do>>
<<dd_do>>
list year month ab1mt b2mt ab1_count b2_count ab1_lbs_per_fish b2_lbs_per_fish, abbreviate(16) sum(ab1mt b2mt ab1_count b2_count)
<</dd_do>>
~~~~





<!---

This is the monthly number of a+b1s of Cod, after we apply the 2b95 method. I don't know how to do the 2b95 method.  I'll just have to read it in when I'm assembling those data.

| Year | Month |Trimmed_Landings|
| :------ | :---- | ------- :|
|2020| 	5 |63|
|2020 |	6 |2,267|
|2020 |	7 |1,465|
|2020 |	8 |3,912|
|2020 |	9 |7,829|
|2020 |	10 |955|
|2020 |	11 |0  |
|2021 |	4 | 1,434|
|2021 |	5  |10|
|2021 |	6  |517|
|2021 |	7  |61|
|2021 |	8  |258 |
--->
